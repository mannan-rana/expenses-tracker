<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
    <link rel="stylesheet" href="/client/style.css">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        /* Add this style to make the page scrollable */
        body {
            overflow-y: scroll;
        }

        /* Add padding to the content elements to exceed viewport height */
        .content {
            padding: 20px;
        }

        /* Adjust chart container size to fit both charts */
        #chart {
            display: flex;
            justify-content: space-around;
        }

        /* Adjust the size of each chart */
        .chart {
            width: 45%;
            height: 400px;
        }
    </style>
</head>
<body>
    <h1>Basic Expense Tracker</h1>
    
    <!-- Expense Input Form -->
    <div class="content">
        <h2>Add Expense</h2>
        <form id="expense-form">
            <input type="text" id="description" placeholder="Description" required>
            <input type="number" id="amount" placeholder="Amount" required>
            <button type="submit">Add Expense</button>
        </form>
    </div>

    <!-- Display Expenses -->
    <div class="content">
        <h2>Expenses</h2>
        <ul id="expense-list">
            <!-- Expenses will be listed here -->
        </ul>
    </div>

    <!-- D3.js Visualization (Placeholder) -->
    <div id="chart">
        <div class="chart" id="pie-chart"></div>
        <div class="chart" id="bar-chart"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const expenseForm = document.getElementById('expense-form');
            const descriptionInput = document.getElementById('description');
            const amountInput = document.getElementById('amount');
            const expenseList = document.getElementById('expense-list');
            const pieChartContainer = document.getElementById('pie-chart');
            const barChartContainer = document.getElementById('bar-chart');
        
            // Fetch expenses when the page loads
            fetchExpenses();
        
            expenseForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const description = descriptionInput.value;
                const amount = amountInput.value;
        
                if (description && amount) {
                    addExpense({ description, amount });
                    descriptionInput.value = ''; // Clear description input
                    amountInput.value = ''; // Clear amount input
                } else {
                    alert('Please fill in all fields');
                }
            });
        
            function addExpenseToList(description, amount) {
                const listItem = document.createElement('li');
                listItem.textContent = `${description}: $${amount}`;
                expenseList.appendChild(listItem);
            }
        
            function addExpense(expense) {
                fetch('http://localhost:5000/add-expense', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(expense),
                })
                .then(response => response.json())
                .then(data => {
                    addExpenseToList(data.description, data.amount);
                    fetchExpenses(); // Fetch updated expenses and update the charts
                })
                .catch(error => console.error('Error:', error));
            }
        
            function fetchExpenses() {
                fetch('http://localhost:5000/expenses')
                    .then(response => response.json())
                    .then(data => {
                        // Clear the list and render the updated expenses
                        expenseList.innerHTML = '';
                        data.forEach(expense => addExpenseToList(expense.description, expense.amount));
                        renderCharts(data); // Call the renderCharts function with expenses data
                    })
                    .catch(error => console.error('Error:', error));
            }
        
            // Function to render the D3.js bar chart
            function renderBarChart(expenses) {
                // Clear the existing bar chart
                barChartContainer.innerHTML = '';

                const chartWidth = 400;
                const chartHeight = 400;
                const margin = { top: 20, right: 20, bottom: 40, left: 40 };

                const width = chartWidth - margin.left - margin.right;
                const height = chartHeight - margin.top - margin.bottom;

                const colorScale = d3.scaleOrdinal(d3.schemeCategory10);

                const barSvg = d3.select('#bar-chart')
                    .append('svg')
                    .attr('width', chartWidth)
                    .attr('height', chartHeight);

                const barGroup = barSvg.append('g')
                    .attr('transform', `translate(${margin.left},${margin.top})`);

                const x = d3.scaleBand()
                    .domain(expenses.map(d => d.description))
                    .range([0, width])
                    .padding(0.1);

                const y = d3.scaleLinear()
                    .domain([0, d3.max(expenses, d => d.amount)])
                    .nice()
                    .range([height, 0]);

                barGroup.selectAll('.bar')
                    .data(expenses)
                    .enter().append('rect')
                    .attr('class', 'bar')
                    .attr('x', d => x(d.description))
                    .attr('width', x.bandwidth())
                    .attr('y', d => y(d.amount))
                    .attr('height', d => height - y(d.amount))
                    .attr('fill', (d, i) => colorScale(i));

                barGroup.append('g')
                    .attr('class', 'x-axis')
                    .attr('transform', `translate(0,${height})`)
                    .call(d3.axisBottom(x))
                    .selectAll('text')
                    .style('text-anchor', 'middle');

                barGroup.append('g')
                    .attr('class', 'y-axis')
                    .call(d3.axisLeft(y).ticks(5));

                barGroup.append('text')
                    .attr('x', width / 2)
                    .attr('y', height + margin.bottom - 5)
                    .attr('text-anchor', 'middle')
                    .text('Expense Description');

                barGroup.append('text')
                    .attr('transform', 'rotate(-90)')
                    .attr('x', -height / 2)
                    .attr('y', -margin.left)
                    .attr('dy', '1em')
                    .style('text-anchor', 'middle')
                    .text('Amount ($)');
            }

            // Function to render the D3.js pie chart
            // Function to render the D3.js pie chart
// Function to render the D3.js pie chart
function renderPieChart(expenses) {
    // Clear the existing pie chart
    pieChartContainer.innerHTML = '';

    const chartWidth = 400;
    const chartHeight = 400;

    // Calculate the center position for the pie chart
    const pieX = chartWidth / 2;
    const pieY = chartHeight / 2;

    // Create an SVG element for the pie chart
    const pieSvg = d3.select('#pie-chart')
        .append('svg')
        .attr('width', chartWidth)
        .attr('height', chartHeight);

    // Create an arc generator for the pie chart
    const arc = d3.arc()
        .innerRadius(0)
        .outerRadius(Math.min(chartWidth, chartHeight) / 2);

    // Create a pie layout
    const pie = d3.pie()
        .value(d => d.amount)
        .sort(null);

    // Define a color scale for the pie chart slices
    const colorScale = d3.scaleOrdinal(d3.schemeCategory10);

    // Translate the SVG element to the center position
    const pieGroup = pieSvg.append('g')
        .attr('transform', `translate(${pieX},${pieY})`);

    // Create arcs for the pie chart
    const arcs = pieGroup.selectAll('.arc')
        .data(pie(expenses))
        .enter().append('g')
        .attr('class', 'arc');

    // Add slices to the pie chart with color assignment
    arcs.append('path')
        .attr('d', arc)
        .attr('fill', (d, i) => colorScale(i)); // Assign different colors based on index

    // Add labels to the pie chart
    arcs.append('text')
        .attr('transform', d => `translate(${arc.centroid(d)})`)
        .attr('dy', '0.35em')
        .text(d => d.data.description);
}

            function renderCharts(expenses) {
                renderBarChart(expenses);
                renderPieChart(expenses);
            }
        });
    </script>
</body>
</html>
